<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kidney Disease Analysis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body{background: linear-gradient(135deg,#f6f9ff 0%,#e6f7ff 100%);min-height:100vh}
      .card-center{max-width:820px;margin:48px auto;padding:24px;border-radius:16px;box-shadow:0 10px 30px rgba(32,45,80,0.08)}
      .drop-area{border:2px dashed rgba(0,123,255,0.25);border-radius:12px;padding:28px;text-align:center;background:#fff}
      .preview-img{max-width:100%;height:auto;border-radius:8px}
      #labelResult{font-size:1.6rem;font-weight:700}
      .hidden{display:none}
    </style>
  </head>
  <body>
    <div class="container">
      <div class="card card-center">
        <div class="row g-3 align-items-center">
          <div class="col-12 col-md-6">
            <h3 class="mb-2">Kidney Disease Analysis</h3>
            <p class="text-muted">Upload a CT image and click Analyze. The predicted label will appear below.</p>

            <div id="drop" class="drop-area mb-3">
              <p class="mb-1">Drag & drop an image here, or</p>
              <label class="btn btn-outline-primary btn-sm">
                Choose file
                <input id="fileInput" type="file" accept="image/*" class="visually-hidden">
              </label>
              <div id="filename" class="mt-2 text-truncate text-muted"></div>
            </div>

            <div class="d-flex gap-2">
              <button id="analyzeBtn" class="btn btn-primary btn-lg flex-grow-1">Analyze</button>
              <button id="clearBtn" class="btn btn-outline-secondary">Clear</button>
            </div>

            <div class="mt-4">
              <div class="small text-muted">Prediction</div>
              <div id="labelResult" class="mt-2 text-primary">No prediction yet</div>
            </div>
          </div>

          <div class="col-12 col-md-6 text-center">
            <div class="bg-white p-3 rounded-3">
              <img id="preview" class="preview-img hidden" src="" alt="preview image">
              <div id="previewPlaceholder" class="text-muted">Preview will appear here</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const fileInput = document.getElementById('fileInput');
      const drop = document.getElementById('drop');
      const preview = document.getElementById('preview');
      const previewPlaceholder = document.getElementById('previewPlaceholder');
      const analyzeBtn = document.getElementById('analyzeBtn');
      const clearBtn = document.getElementById('clearBtn');
      const labelResult = document.getElementById('labelResult');
      const filename = document.getElementById('filename');

      let currentFile = null;

      function showPreview(file) {
        const url = URL.createObjectURL(file);
        preview.src = url;
        preview.classList.remove('hidden');
        previewPlaceholder.style.display = 'none';
        filename.textContent = file.name;
      }

      fileInput.addEventListener('change', (e)=>{
        const f = e.target.files[0];
        if (!f) return;
        currentFile = f;
        showPreview(f);
        labelResult.textContent = 'Ready to analyze';
      });

      ;['dragenter','dragover'].forEach(ev=>{
        drop.addEventListener(ev, (e)=>{ e.preventDefault(); drop.classList.add('border-primary'); });
      });
      ;['dragleave','drop'].forEach(ev=>{
        drop.addEventListener(ev, (e)=>{ e.preventDefault(); drop.classList.remove('border-primary'); });
      });

      drop.addEventListener('drop', (e)=>{
        const f = e.dataTransfer.files[0];
        if (!f) return;
        currentFile = f;
        showPreview(f);
        labelResult.textContent = 'Ready to analyze';
      });

      clearBtn.addEventListener('click', ()=>{
        currentFile = null;
        preview.src = '';
        preview.classList.add('hidden');
        previewPlaceholder.style.display = '';
        filename.textContent = '';
        labelResult.textContent = 'No prediction yet';
        fileInput.value = '';
      });

      analyzeBtn.addEventListener('click', async ()=>{
        if (!currentFile) { alert('Please select an image first'); return; }
        labelResult.textContent = 'Analyzing...';
        const fd = new FormData();
        fd.append('file', currentFile);
        try {
          const resp = await fetch('/predict', { method: 'POST', body: fd });
          const data = await resp.json();
          if (!resp.ok) {
            labelResult.textContent = data.error || 'Prediction failed';
            labelResult.classList.remove('text-primary');
            labelResult.classList.add('text-danger');
            return;
          }
          // show only the predicted label name if available, otherwise numeric
          const label = data.label || (typeof data.prediction !== 'undefined' ? String(data.prediction) : null);
          labelResult.textContent = label || 'No label returned';
          labelResult.classList.remove('text-danger');
          labelResult.classList.add('text-primary');
        } catch (err) {
          labelResult.textContent = 'Request failed';
          labelResult.classList.remove('text-primary');
          labelResult.classList.add('text-danger');
        }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>